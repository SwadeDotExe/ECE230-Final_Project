# Embedded Systems RC Car
  ![C](https://img.shields.io/badge/c-%2300599C.svg?style=for-the-badge&logo=c&logoColor=white)
  ![Launchpad](https://img.shields.io/badge/TI%20LaunchPad-%23D00000.svg?style=for-the-badge&logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAACi1BMVEVHcEwAAAAKCgoFBQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAODg4AAAAREREAAAADAwMAAAACAgIJCQkICAgICAgFBQUGBgYCAgIGBgYHBwcBAQEAAAABAQEICAgBAQEBAQECAgIBAQEBAQEDAwMJCQkAAAADAwMAAAABAQEODg4BAQEGBgYXFxcLCwsODg4NDQ0NDQ0CAgIKCgoFBQUICAgJCQkbGxsCAgIGBgYNDQ0sLCwDAwMDAwMlJSUNDQ0nJydISEgEBAQqKioHBwcDAwMCAgIQEBAKCgoDAwMCAgIgICAmJiYBAQEDAwMCAgIKCgoODg4YGBgBAQEFBQUNDQ0WFhYCAgIBAQEEBAQEBAQBAQEDAwMBAQEBAQEBAQEHBwcCAgIHBwcGBgYCAgIDAwMFBQUBAQEDAwMGBgYBAQE0NDQAAAAKCgoHBwcCAgIBAQEODg4JCQkGBgYCAgIFBQUDAwMYGBgCAgIDAwMCAgIwMDAHBwcCAgIaGhoDAwMDAwMFBQULCwsCAgIFBQUGBgYCAgIEBAQEBAQBAQEHBwcBAQEFBQUHBwcCAgIHBwcDAwMDAwMCAgIEBAQBAQECAgIGBgYCAgIDAwMLCwsLCwsaGhoaGhoEBAQFBQUaGhoFBQUGBgYCAgITExMQEBADAwMGBgYCAgIMDAwKCgoFBQULCwt1dXUKCgoXFxcDAwMICAgBAQEBAQEBAQECAgIEBAQBAQEBAQEFBQUEBAQGBgYEBAQKCgoTExMGBgYBAQEDAwMCAgICAgIlJSUGBgYCAgIkJCQKCgoEBAQGBgYICAgICAgGBgYFBQUGBgYDAwMEBAQCAgIFBQUTExMFBQUJCQkJCQkGBgYAAAABAQHCS%2B33AAAA13RSTlMAAwED%2BvsC%2Fvz9%2BAEBJvl4CNwCAgGTAs93AvwE90ng7cGbAcNNB6v3AyreagovLC4o2D0vNjAIzT8pBqfQBScGBKsGz9HQATDA6gwFAonlUC0V8bYhIvvQA5fn6PXl5IbDdE6WA5IGl1viBAZARgTZJzde5Ii5F7tolQEB2gOhkWRTyAVyy6ON7D%2FydEdsQbqiaFm4YEl0tiRGCBJzbg%2BATawTFX1DvR1UghYCFhVjQqn2x54t2ut8UHFvKhWIy3zGnwhW3gQonoRXMoOHVGZX66oUlTtAUujLfCIAAAH%2FSURBVHjabcwD3%2BNAFIXx0zbpnby2zbVt27Zt27Zt27Ztn3yczSTr7X%2Fan56cC1c4uvbu1bdfVp%2F%2BCOJ%2FfkTS1VPnwOz%2FsyWWGBzsrfPwlwTUEwpN5sKHp49v%2F92dXOFnLsQLPrmDxeOGBFIBTzxK6qx4DMBH2pH4SxzKkaLf8y%2F49Pklnt1aO2PExFm%2F1uVJcebFfI33b7%2FhDR32SnhSUVavLZJfX9n8gAekEcVN8CShKimK%2BdfvPnpHFuHmyfUM4xb8VNnNJwA8JO8DWM5ibgQa1GpUv241VCEtrjqECNwjbwBY6qy3AY2b1GmanFy9IsVi7M6CU2euMez4jsyF2TS5GWhIj7h%2F%2B%2FwV8iq2kxRR3AAkUjksCkV48ew58sLpLCohhRkAUmiJt3XO4zIZfVhvqR%2FCg6hNRZfJg7hEHt2qB%2FrrkUAANfQpUYZlcM8%2Bm%2FbuaJq6hnEAHGVKUVmKpMEDu%2FYf2YscGhSTbJcJoARK04n5U%2BaQa%2BCYu2SZvtcypRU8iXbGQGBaLFcjJiamEAtIe2hHoA08lWoCo1HAFeugFXHyGCC9GTwRQFD%2FplJNnzl%2F3iJmT0B6OH6J8wMIYCwtuiZhGP4TgRxGGUYUx49CCD0wiErE5HD4EFILGs6LDp2T0DyNhsm2oTN8aN%2BNJru3RmhBdOicxk5d4If2Hc8s88T3JSgVAAAAAElFTkSuQmCC&logoColor=white)
  ![Rose](https://img.shields.io/badge/School%20Project-%2375140c.svg?style=for-the-badge&logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAChVBMVEVHcEz%2F%2F%2F%2Fs29vt3Nz%2B%2Fv79%2B%2Fvw4%2BP%2B%2Fv7%2B%2Fv7%2B%2Fv7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2B%2Fv7%2B%2Fv7%2F%2F%2F%2F59PTx5OTx4%2BP58%2FP%2F%2F%2F%2F17Oz%2F%2F%2F%2Fr29v59PTcurr9%2B%2Fv%2F%2F%2F%2F17Oz58%2FP8%2Bvr8%2Bfn%2F%2F%2F%2F7%2BPgAAADz6en59PT59PTMmpq8eXns2Nj69fb8%2Bfn58%2FPmz87Ik5P9%2FPz37%2B%2Fz6Od%2BBAX48fHw5OTx4%2BPmzs77%2BPjz6Oj%2F%2F%2F7v4ODkyMfr2trz6Oj59PTt3d327ezx5eX%2F%2Fv%2Fjx8f9%2B%2FvLmZhTAADs2tr8%2Bfnbtrb69vXky8vt3Nzp2Nf59fTv4eH%2F%2F%2F%2FiyMj17u3r29v17Ov17Ozt3d348vL27%2B7u3t79%2Ffz69fX27u%2F48fHmz869e3rew8Pq2Njv4eHp09P9%2FPz69vbz6OnlzczgwcHw4eH16%2Bvkzc327%2B%2F48vLOnp7w4eHw4%2BPr2dj69vaqXV7ky8vr2dnv4uL79%2Ff58%2FO8fX7o0dH48%2FP69fXq2dndvLzy5uX38PD69%2Fb38PD59PTz6en8%2B%2Fv48vLv4eHr2dnx5eTn0ND49PT%2B%2F%2F%2F28PDp1dX06%2Br06en%2F%2F%2F%2Fx5eX7%2BPjw4eHcvr717Oz69fXm0NH48vLv4eHq2dnfwcDx5ubcvr3y5%2Bf8%2Bvr16%2Bv06urs29v38PDt3d3u397MnZ7s29z7%2BPjTrKz7%2Bfj38PD8%2Bvr06ur%2F%2F%2F%2FewcH27u748vG6dXfw4uL27e39%2B%2Fvt3d1CAADw4eHbt7j69vb37%2B%2Fm0tLz6ur59PT69vb%2B%2Ff3Wrq716%2Bv27%2B%2F59PTt3Nzr2dn7%2BPjv4eHgw8Po09Tr29v06%2Bv48vLXsbH38fH59fX69vb69vX%2F%2F%2F%2F%2B%2Fv7%2F%2B%2Fv%2F%2Fv5M%2BX8vAAAA03RSTlMAAyko%2B%2FkC%2Fvz9%2Fvz7%2BfoCuAICyQGb%2FWLLAfj6mMr%2B%2B%2Fn1ASjMyRcLAeTvvAEUAwN4AwMCAQHtAwMCIzB92CcDA%2F4B%2Fg8DAfkZ5icpAd8DBBoBRmuVKAOfLPvXgKokCyEqAgH54AMBB2CLLbDED1dnAeUKAUkG3cUYAQTEZhNxtuevt5UCuV8FAjAF%2FrA6j5cHhOkpH5zWNsNAATVbHnfvmikovWddH0bgKO%2Bh6334NZK9C12i9ioCfR7imSIozen9BKrG2R5k9isQIWMruhTIzczSeffHXQAAAf5JREFUeNp10gOb5EoAheGT25lblfbYnlnbtm3btm3btm3b1und37OVZNrPft3hGyewGr%2F75NPi4i9vP3749A2AbwYiaogR%2BQzwBb%2B%2B4%2Fvnz25sBZpHcG04RtNJSf9nplE1uQNqhTkJjiwaQqc%2FnbohvWns2An1IzmBgtJklxAUHnZtg7pB%2Fh%2F%2FhbhAKqaHOdDieNUSki7lgu0boUIsL14wZ%2FoUOoWT2ayBarGcC1Uf8%2FySlZESy8nQ5mLWTBrCYMXyiGdAw1rqiiuVQ2aQHWFOwQFKxfWqBrkbBpSdu0hbj6OFFIqb1oRdT6CH4oDkfKhO08PNOofAZ2k7DO09eKBig%2FPWHTl47swV6nRzAqpb3AXDf1MIkubAS1cvXqCXK6aiCqw09KeurCWF25VGXr7OAi5DA9i1QC%2F7TVCojGs8e4zLEVHbQZROxYbXoNPg8cOrl2JUSDU0oTsQoEGag5crgXFA%2BKk1bm1d%2Bb6du5QLN6ehX5jroFkWBXVux%2F586%2FmMGYZWIU5E5wSL9wLb1ITZnIjuEdzX5lRgj%2FlIBfM2YmSYHUHegRw1Vf%2BbSIn%2BFAMmb8KkPArxx83bWBS68lN3nbr08AQ0H7bQI6WXj25hoc0bcI9Wd6CNxXnaPYbP5kN48v1HSUnpmwdYA9x%2F9as0IyPj5%2BuHmI1%2FV%2FQSwF9K9ey8Mks8hgAAAABJRU5ErkJggg%3D%3D&logoColor=white)

  ## Description
  This repository is my ECE230 (Embedded Systems) capstone project that won the award for "Best Project" that quarter. We used the Texas Instruments MSP432 development board as the microcontroller in our system, and interfaced with various sensors and periphrials to meet the requirements of the project. Some of the sensors are:
  * Voltage reading on the battery
  * Current shunt for amp draw
  * Sonar sensor for distance
  * Wheel speed sensor
  
  This write-up is going to be a little different than what I do for personal project, simply because it is an academic project that had to meet certain requirements.

  ## Table of Contents
  * [Proposal](#proposal)  
  * [Project Plan](#project-plan)
  * [Progress Report](#progress-report)
  * [Installation](#installation)
  * [Calibration](#calibration)
  * [Visualization](#visualization)

  ## Proposal
  ### General Requirements
  We are going to create a remote controlled car that runs off of the MSP432P111 microcontroller with a variety of sensors and output devices. The bulk of the project will be interfacing the microcontroller with the drive system of the car, which will most likely be purchased secondhand and retrofitted for our needs. The car we purchase (or create) will need to be big enough to encase the MSP and carry the battery pack and extra peripherals we decide to include, and be able to support the weight of all these devices. We plan to control the car through a remote terminal connected via bluetooth that transmits keyboard commands to the vehicle, and receive metrics about the car’s status.
  
  ### Specifications
  * 2 (or 4) drive wheels to move the car
  * Integrated battery pack to power the vehicle
  * Working headlights and possibly interior lighting
  * Accelerometer on vehicle that feeds metrics back to terminal
  * ESP32-CAM module to send live video feed to computer

  ### Strategy
  #### Motors
  * Connected to the ULN2003 driver board (Exercise 5-1)
  * Servo motor to be used to open and close driver’s side door
  * Wired directly to power rails on internal breadboard

  #### Control
  * Wireless connection established through HC-06 bluetooth module (Exercise 7-1)
  * Control will use a UART serial terminal to communicate between car and computer
  * All functionality (movement, lights, doors, etc.) will use keyboard input

  #### Power
  * 10,000 mAh USB battery pack to supply power rails and microcontroller
  * Real-time shunt current monitor using MSP to send over serial

  #### Peripherals
  * Sonar sensor mounted on front for collision detection
  * Emergency kill-switch mounted wirelessly (fire alarm pull station)
  * Headlights powered by white LEDs, brake lights by red LEDs.
  * ESP32-CAM to send live feed of car to web browser

  ### Schedule
  <img src="/Images/Schedule.png" width=75% height=75%>
  
  ### Budget
  | Component        | Quantity      | Description | Cost          |
  | ---------------- |:-------------:|-------------|:-------------:|
  | White LEDs       | 2             | Headlights  | Have          |
  | Red LEDs         | 2             | Taillights  | Have          |
  | HC-SR04          | 1             | Sonar sensor| Have          |
  | RC Car Base      | 1             | Base of car | $10-$20       |
  | ESP32-CAM        | 1             | Video feed  | Have          |
  | Various Parts    | N/A           | Resistors, caps, etc. | Have    |
  
  
  ## Project Plan
  <img src="/Images/Project%20Plan.jpg" width=75% height=75%>
  
  ## Progress Report 
  **Date: 2/12/2022**
  ### Current Status
  #### Car Body - Swade and Bryce
  <img align="right" src="/Images/CarBody.jpg" width=40% height=40%>
  The car chassis that we ordered from Amazon was delivered on Tuesday (2/8), and has proved to be the exact fit for what we needed. The kit included 4 DC motors with wheels, and the acrylic chassis with mounting hardware. An additional component that came with the kit was encoder wheels that mount on the drive shaft of each motor, leading to the addition of an IR beam sensor which is being utilized as a tachometer. As for mounting our MSP on the car, we utilized double sided tape to secure it on the top acrylic plate. We have a battery pack we plan to use to power the circuit, but we might need to relocate the MSP to accommodate the large space that will be taken up. Overall, we are very satisfied with the kit and it will work well for this project.

<br/><br/>

  #### Sensors - Swade
  <img align="right" src="/Images/Sensors.jpg" width=40% height=40%>
  Right now, we have 5 sensors on the chassis that are fully integrated, coded, and working with the MSP:
  * Shunt (Current) Sensor — Homemade — ADC
  * System Voltage Sensor — Homemade — ADC
  * Tachometer — FC-03 — ADC
  * Accelerometer — GY-521 — I2C
  * Sonar Sensor — HC-SR04 — Timer_A0
  The sonar sensor was by far the most complex to integrate in our system, due to how the sensor operates. In short, the MSP supplies a 10us pulse to the sensor which initiates the scanning sequence. After it scans the area, the sonar sensor responds with a singular pulse that varies in length proportional to the distance the sensor reads. The way this was implemented on the MSP is utilizing a timer in up-mode and when the rising edge of the length pulse is detected, the timer ticks are recorded until the falling edge of that signal. We recognize this can be implemented with a capture timer instead, and we plan to refactor this in the future. The other sensors are self explanatory, and were fairly easy to implement, be it with the ADC module or I2C.

  #### Bluetooth - Swade
  <img align="right" src="/Images/Bluetooth.jpg" width=40% height=40%>
  A key component of this project is the wireless control of the vehicle, along with sending data from the car back to the controller. Our goal is to use a second MSP to do all the controlling of the car, which means we need a master bluetooth controller to initiate the connection and a slave to listen. Unfortunately the HC-06 that we were provided can only operate in slave mode, which led us to purchase a HC-05 to serve as the master. After configuring these bluetooth modules, all that was left was to create an encoding scheme for our messages. We found that starting and ending our messages with a unique character worked well for regex, as we can simply listen for that specific character to trigger different aspects of our code. Going forward, we might want to implement some sort of error detection to help with corrupted messages that we’ve noticed every once in a while.
  
  #### Motor Power - Bryce
  <img align="right" src="/Images/Motors.png" width=40% height=40%>
  For a car, one of the most important functions is undoubtedly the ability to move. For this we came to the decision of using an IC that we have previous experience with for driving motors with reversible rotation, the L293D. We harvested one from our ECE 160 kit as well as finding another in a piece of hardware we had on hand. By analyzing the technical manuals of the L293D, we were able to save 8 pins by leaving the IC enabled and controlling each side, left and right with only their two PWM inputs and using the same PWM for the second driving IC  so each motor receives its own side of an L293D.  We encountered the problem that when driving all 4 motors, the voltage drop is significant enough to slow the motors we were originally testing with; however, we have yet to test this issue with our final motors that we received as part of our car kit and we are yet still deciding on whether or not to amplify the output of the driver.
  
  #### Steering - Bryce
  <img align="right" src="/Images/Steering.png" width=40% height=40%>
  In order to control the vehicle, we decided to use a singular joystick, being read by the MSP ADCs as potentiometers through P5.4 and P5.5, as a means of steering the car. This can be accomplished by mapping the Y axis of the stick to changing the PWM of both the right and left sets of motors at the same time to the same rates to control forward and backwards motion. As for turning, moving the stick into the left side of the X axis to turn left, will only add pulse width to the right side of the vehicle to cause the car to turn, likewise for turning right. While this has yet to be fully implemented, the logic has been thoroughly discussed and thought out. The driver for the stick is nearly complete and is awaiting final testing. A module for mapping the stick input is under development as well to simplify the process of implementing it into the final code of the vehicle’s MSP.

  ### Current/Future Work
  #### PCB Design - Swade
  <img align="right" src="/Images/PCB.png" width=40% height=40%>
  We noticed that our breadboard has become a tangled mess of wires while adding more sensors to our car. Taking inspiration from the MSP “shield” connector on the top of the device, we decided to create our own custom PCB that will plug in to the top of the development board and interface with all our sensors. We plan to order this PCB no later than Monday (2/14) so it is here in a timely fashion. We will also look into our options at Rose-Hulman for PCB manufacturing on Monday as well.

  README in progress!
